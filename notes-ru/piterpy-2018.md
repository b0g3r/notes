## 1.

Всем привет. Меня зовут Грам, а эту курицу -- мисс Ревью. И я отдам её тому, кто после выступления задаст самый интересный вопрос. Ну а расскажем мы про хороший, плохой и ужасный код.

## 2.

Но для начала давайте немного о том, зачем я это всё рассказываю. Я видел много плохого кода. Очень много. 4 года, ещё в лицее и университете, я делал сайты на PHP за 3-5 тысяч рублей. Часто приходилось дописывать код за такими же студентами, как я, и попадались действительно запутанные вещи.

Затем я работал в компании Smena. Нам от предыдущих разработчиков достался огромный legacy монолит на django, из которого мы всеми силами делали проект, который будет легко и не больно сопровождать. И, мне кажется, мы многого добились.

Ну а сейчас я работаю в компании Cindicator. И первая задача, с которой я столкнулся -- переписывание кода, написанного MLщиками. Надо сказать, это производит неизгладимое впечатление на психику. Само ядро машинного обучения я почти не трогал, там очень много крутой магии, а вот механизмы, которые с этим работают, пришлось переписать практически с нуля.

## 3.

И вот я здесь. И первое, о чём я хочу вам рассказать -- PHP. Слева вы видите взгляд Марка Цукерберга, когда ему напомнили, что он написал крупнейшую соц. сеть на PHP. А справа -- причины, почему PHP не люблю я.

1. Во-первых, алиасы. Есть много способов сделать одно и то же, и, чтобы читать чужой код, вам нужно знать каждый.
2. Во-вторых, strstr и stristr делают одно и то же: ищут подстроку в строке. Просто один делает это регистронезависимо. Мы привыкли, что обычно подобные вещи делает одна функция, которая чуть меняет своё поведение в зависимости от переданного параметра. Но в PHP это не так, тут для всего отдельная функция.
3. В-третьих, нет порядка в именовании функций. Они могут содержать нижний прочерк, а могут и не содержать. Вы не узнаете этого, пока не заглянете в документацию или просто не выучите написание каждой.
4. Вы думали, все строковые функции содержат в названии str? А вот и нет. Вот функция trim, которая убирает пробельные символы из начала и конца строки. Она работает только со строками. Зато функция strlen может принять, например, число. К тому же, она считает не количество символов, как хотелось бы, а количество байт.

## 4.

Ну и отдельная тема -- приведение типов. Вот пример, когда две разных строки интерпретируются как два числа с плавающей точкой и приводятся к нулю. В результате имеем нестрогое равенство.

Причины этих проблем кроются в том, что PHP задумывался как простенький шаблонизатор для удобного написания персональной странички, а не как язык для крупнейшей соц. сети в мире. И даже назывался он изначально Personal Home Page.

## 5.

Первая версия PHP выглядела как-то так. Она умела подключать другие PHP-шаблоны, выполнять SQL-запросы, и имела даже проверку условий. Пример взят с официального сайта PHP. Кроме неинтуитивности кода и отсутствия Тьюринг полноты, кто видит здесь серьезную такую проблему?

Да, это SQL-инъекция. Первый же пример позволяет дропнуть всю вашу базу данных.

После этого PHP много раз переписывался с нуля, но никто так и не подошёл к этому процессу серьезно, никто не исправил те проблемы, о которых я рассказал.

## 6.

Но это всё было давно и как будто бы не должно нас беспокоить. Мы же пишем на python. Но не так давно мне пришлось интегрировать в проект работу с API одного банка. Название банка зашифровано, любые совпадения случайны. Так вот, этот API писал кот.

1. Во-первых, названия одних и тех же полей могут приходить в разных регистрах для разных методов. Это путает и усложняет работу с полями.
2. Во-вторых, как узнать, что всё хорошо? Конечно же проверить поле error code! Код ошибки 0 означает, что ошибки нет. Просто вдумайтесь: код ошибки для отсутствия ошибки.
3. В-третьих, это поле может содержать число, строку, а иногда отсутствовать в ответе. Для каждого метода API поведение своё.
4. Ну и главное, что хотелось бы отметить, и что уже не получится исправить с помощью простенькой оберткой вокруг API: есть чуть меньше 10 возможных error code, и каждый из них включает целую группу ошибок. Конкретная же ошибка описывается в поле error message. Однако мы не можем с ним программно работать, чтобы на уровне системы определить конкретную ошибку, т.к. текст ошибки возвращается на языке пользователя `¯\_(ツ)_/¯`

## 7.

Ну хватит о грустном. Давайте поговорим о том, как всё делать хорошо.

Для каждой значимой фичи, связанной с Python, пишется PEP -- python enhancement proposal. Есть описание для самых разный вещей:

1. PEP-8. Самый известный PEP, описывающий общий стиль написания кода на Python. Какие должны быть отступы, длина строки и т.д.
1. PEP-20. Философские принципы, лежащие в основе Python, за которые мы так его любим. Например, "Явное лучше неявного"
1. PEP-537 описывает расписание релизов для Python 3.7. Такой есть для каждой минорной версии Python.
1. PEP-248 описывает единый интерфейс по работе с базами данных. Не важно, возьмете вы библиотеку для postgres, mysql или sqlite, в ней обязательно будут объекты connection и cursor, у cursor будет метод fetchone и т.д.

## 8.
